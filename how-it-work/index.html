<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>basic11 rom - Orix</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "basic11 rom";
    var mkdocs_page_input_path = "how-it-work/index.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Orix</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">Home</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../home/">Install envs for developpers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/buildman/">Manual pages</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/buildrom/">Rom Structure</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/cc65/">Cc65 use</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/firmware/">Firmwares</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/hardware/">Hardware</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/header/">Header</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/joysticks/">Joysticks management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/kernel/">Kernel</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/memory/">Memory management</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/orixsdk/">Orix SDK</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../home/pizero_connection/">Pi zero connection</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">How it work</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">basic11 rom</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#si-on-tape-basic11">Si on tape : /#basic11</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#si-on-tape-basic11-tapefile">Si on tape : /#basic11 "TAPEFILE"</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#si-on-tape-basic11-l">Si on tape : /#basic11 -l</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fonctionnement-global">Fonctionnement global</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="binary_starts/">Binary start sequence</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Libs</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../libs/twillib/">Twil libs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Samples</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Asm samples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../samples/asm_samples/">Samples in Assembly</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">C samples</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../samples/c_samples/">Open and read files with cc65</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../samples/c_samples/getcwd/">Get CWD in cc65</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../samples/c_samples/mkdir/">Create a folder with cc65</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../samples/c_samples/putcwd/">chdir in cc65</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../samples/c_samples/writefile/">Write a file</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tools</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../tools/mount/">Mount (not developed yet)</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Orix</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>How it work &raquo;</li>
        
      
    
    <li>basic11 rom</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="basic11-rom">basic11 rom</h1>
<p>Dans tous les cas, les valeurs de RND en $FA ont été copiées en avance</p>
<h2 id="si-on-tape-basic11">Si on tape : /#basic11</h2>
<p>Cela lance la ROM</p>
<h2 id="si-on-tape-basic11-tapefile">Si on tape : /#basic11 "TAPEFILE"</h2>
<ul>
<li>
<p>Cela va chercher la présence d'un fichier db dans /var/cache/basic11/[FIRSTLETTEROFTAPEFILE]/TAPEFILE.db</p>
</li>
<li>
<p>Si TAPEFILE.db est présent, il va lire les 1er octets du fichiers pour poker en $F1 les I/O des joysticks, sinon il va démarrer la banque 6 qui est la ROM par défaut qui contient le path courant : /home/basic11/</p>
</li>
<li>
<p>Le code va regarder l'id de la ROM (stockée en $F2 suite au load des confs au point précédent</p>
</li>
<li>
<p>Cela va détecter aussi si le device par défaut est la sdcard ou la clé usb</p>
</li>
<li>
<p>Le code va concaténer /usr/share/basic11/basic avec le device courant (us ou sd) puis l'id de la rom converti en ascii</p>
</li>
<li>
<p>La rom va être chargée en ram principale puis basic11 va copier un driver en ram principale. Si la rom demandée n'est pas trouvée, le programme s'arrête avec un message d'erreur.</p>
</li>
<li>
<p>Ce driver passe en RAM 0 (banque 0) copie la ROM chargée en ram principale, puis va patcher le path par défaut pour accéder au .tap demandé. Ainsi, la ROM serait présente en RAM 0, avec le path par défaut tel que : 
/usr/share/basic11/3/ pour 3dfongus</p>
</li>
</ul>
<p>Ainsi, la ROM a en argument 3Dfongus, et la rom charge donc à partir de là.</p>
<p>Le code gère un maximum de 9 roms en mode usb, et 9 en rom sd. Un soft défini avec une ROM 10 ne fonctionnera pas, c'est à dire que la rom ne sera pas chargée, et un message d'erreur dira qu'il ne trouve pas la rom.</p>
<h2 id="si-on-tape-basic11-l">Si on tape : /#basic11 -l</h2>
<p>Cela va ouvrir le fichier /var/cache/basic11/basic11.db</p>
<p>Et cela va lire la clé du .tap et le nom du soft tronqué à 29 chars.</p>
<p>L'espace et le ctrl+c fonctionne ici</p>
<h2 id="fonctionnement-global">Fonctionnement global</h2>
<p>Si la rom est lancée sans .tap ou avec un .tap, systématiquement, les valeurs de RND seront écrites en dur en RAM de $FA à $FF. Cela interfera à terme avec la ROM basic oric-1</p>
<h1 id="format-du-fichier-maindb-basic11db">Format du fichier "maindb" (basic11.db)</h1>
<h2 id="version-1">Version 1</h2>
<ul>
<li>
<p>1er octet : numero de version du fichier db (actuel : 1)</p>
</li>
<li>
<p>puis la liste des noms de fichiers puis le titre tels que :
filenametap8bytesLength ;  name_software '\0'</p>
</li>
<li>
<p>en dernier octet à la fin du fichier, nous avons l'octet $ff qui signale la fin du fichier (ceci permettant de simplifier le code de lecture)</p>
</li>
</ul>
<h1 id="format-du-fichier-db-dun-soft">Format du fichier .db d'un soft</h1>
<ul>
<li>
<p>version_bin : 1 byte (binary)</p>
</li>
<li>
<p>rombasic11 : 1 byte, id of the rom</p>
</li>
<li>
<p>fire2_joy : keyboard fire2 matrix</p>
</li>
<li>
<p>fire3_joy : keyboard fire2 matrix</p>
</li>
<li>
<p>down_joy : keyboard fire2 matrix</p>
</li>
<li>
<p>right_joy : keyboard fire2 matrix</p>
</li>
<li>
<p>left_joy : keyboard fire2 matrix</p>
</li>
<li>
<p>fire1_joy : keyboard fire2 matrix</p>
</li>
<li>
<p>up_joy : keyboard fire2 matrix</p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="binary_starts/" class="btn btn-neutral float-right" title="Binary start sequence">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../home/pizero_connection/" class="btn btn-neutral" title="Pi zero connection"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../home/pizero_connection/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="binary_starts/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
